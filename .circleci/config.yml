version: 2.1
orbs:
  go: circleci/go@1.18
jobs:
  build:
    docker:
      - image: juampynr/drupal8ci:latest

    working_directory: /opt/drupal

    steps:
      - checkout

      - uses: actions/setup-go@v3
        with:
          go-version: '^1.18'

      - run:
        name: Build application
        command: |
          go build

      - run:
        name: Build Drupal skeleton with Composer Drupal Project
        command: |
          composer create-project drupal-composer/drupal-project:9.x-dev drupal --stability dev --no-interaction

      - run:
        name: Copy application binary and run it
        command: |
          cp drupal9ci drupal/
          cd drupal
          ./drupal9ci BitBucket
