version: 2.1
jobs:
  build:
    docker:
      - image: juampynr/drupal8ci:latest

    working_directory: /opt/drupal

    steps:
      - checkout

      - run:
          name: Build application
          command: |
            wget https://go.dev/dl/go1.18.3.linux-amd64.tar.gz
            rm -rf /usr/local/go && tar -C /usr/local -xzf go1.18.3.linux-amd64.tar.gz
            export PATH=$PATH:/usr/local/go/bin
            go version
            go build

      - run:
          name: Build Drupal skeleton with Composer Drupal Project
          command: |
            composer create-project drupal-composer/drupal-project:9.x-dev drupal --stability dev --no-interaction

      - run:
          name: Copy application binary and run it
          command: |
            cp drupal9ci drupal/
            cd drupal
            # We can't test interactive mode here so we pass a CI provider.
            ./drupal9ci Bitbucket
